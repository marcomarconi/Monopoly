mutate(df, date=yearweek(Date), dow=wday(Date), Year=year(Date))
a
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date), Year=year(Date)) %>% group_by(Year, dom) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=2*sd(Return, na.rm=T)/sqrt(n()))
a
p <- ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5)
p
p <- ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_grid(~Year)
p
p <- ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_grid(~Year, cols = 5)
p <- ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)
p
ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8))
ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date), Year=year(Date)) %>% group_by(Year, dom) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=1*sd(Return, na.rm=T)/sqrt(n()))
ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date), Year=year(Date)) %>% group_by(Year, dom) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
df <- BackAdj[["HE"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date), Year=year(Date)) %>% group_by(Year, dom) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a <- mutate(df, dom=wday(Date), date=yearweek(Date)) %>%
mutate( Cost = 0.0011)%>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom == 2 & Trend < 0 & Basis < 0 ~ -1  , dom > 2 & Trend > 0 & Basis > 0 ~ 1  , TRUE ~ 0))
a <- mutate(df, dom=wday(Date), date=yearweek(Date)) %>%
mutate( Cost = 0.0011)%>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom == 2 & Trend < 0 & Basis < 0 ~ -1  , dom > 2 & Trend > 0 & Basis > 0 ~ 1  , TRUE ~ 0)) %>% group_by(Year, dom) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
a <- mutate(df, dom=wday(Date), date=yearweek(Date)) %>%
mutate( Cost = 0.0011)%>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom == 2 & Trend < 0 & Basis < 0 ~ -1  , dom > 2 & Trend > 0 & Basis > 0 ~ 1  , TRUE ~ 0), Year=year(Date)) %>% group_by(Year, dom) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
ggplot(a) + geom_bar(aes(Week, Mean), stat="identity") + geom_errorbar(aes(x=Week, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a
ggplot(a) + geom_bar(aes(dom, Mean), stat="identity") + geom_errorbar(aes(x=dom, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a <- mutate(df, dom=wday(Date), date=yearweek(Date)) %>%
mutate(Z = case_when(dom == 2 ~ 1  , dom > 2 ~ 2  , TRUE ~ 0), Year=year(Date)) %>% group_by(Year, dom) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
ggplot(a) + geom_bar(aes(dom, Mean), stat="identity") + geom_errorbar(aes(x=dom, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a <- mutate(df, dom=wday(Date), date=yearweek(Date)) %>%
mutate(Z = case_when(dom == 2 ~ 1  , dom > 2 ~ 2  , TRUE ~ 0), Year=year(Date)) %>% group_by(Year, Z) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
a
ggplot(a) + geom_bar(aes(Z, Mean), stat="identity") + geom_errorbar(aes(x=Z, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a <- mutate(df, dom=wday(Date), date=yearweek(Date)) %>%  mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Z = case_when(dom == 2 & Trend < 0 & Basis < 0  ~ 1  , dom > 2  & Trend > 0 & Basis > 0 ~ 2  , TRUE ~ 0), Year=year(Date)) %>% group_by(Year, Z) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
a
ggplot(a) + geom_bar(aes(Z, Mean), stat="identity") + geom_errorbar(aes(x=Z, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate(Trade = case_when((dom %in% c(1,3,4)) & Basis < 0 ~ -1 , (dom %in% c(2)) & Basis > 0 ~ 1 ,TRUE ~ 0)) %>% group_by(Year, dom) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate(Trade = case_when((dom %in% c(1,3,4)) & Basis < 0 ~ -1 , (dom %in% c(2)) & Basis > 0 ~ 1 ,TRUE ~ 0), Year=year(Date)) %>% group_by(Year, dom) %>% summarise(Week=first(week(Date)), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
a
ggplot(a) + geom_bar(aes(Z, Mean), stat="identity") + geom_errorbar(aes(x=Z, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
ggplot(a) + geom_bar(aes(dom, Mean), stat="identity") + geom_errorbar(aes(x=dom, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
ggplot(a) + geom_bar(aes(Trade, Mean), stat="identity") + geom_errorbar(aes(x=Trade, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate(Trade = case_when((dom %in% c(1,3,4)) & Basis < 0 ~ -1 , (dom %in% c(2)) & Basis > 0 ~ 1 ,TRUE ~ 0), Year=year(Date)) %>% group_by(Year, dom) %>% summarise(Trade=first(Trade), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
ggplot(a) + geom_bar(aes(Trade, Mean), stat="identity") + geom_errorbar(aes(x=Trade, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
a
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate(Trade = case_when((dom %in% c(1,3,4)) & Basis < 0 ~ -1 , (dom %in% c(2)) & Basis > 0 ~ 1 ,TRUE ~ 0), Year=year(Date)) %>% group_by(Year, Trade) %>% summarise(Trade=first(Trade), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
ggplot(a) + geom_bar(aes(Trade, Mean), stat="identity") + geom_errorbar(aes(x=Trade, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
# GAS
{
df <- BackAdj[["NG"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.001) %>%
mutate(Trade = case_when((dom %in% c(1,3,4)) & Basis < 0 ~ -1 , (dom %in% c(2)) & Basis > 0 ~ 1 ,TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
# Mean annual return      Annualized SD       Sharpe ratio               Skew         Lower tail         Upper tail
#               29.56              38.92               0.78               0.22               2.06               2.01
#               Max DD             Avg DD         Adj Avg DD                GSR                 R2
#               -198.53             -18.17              -0.47               0.75               0.97
}
# OJ
df <- BackAdj[["OJ"]] %>% filter(year(Date) > 2000)
df <- BackAdj[["NG"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.001) %>%
mutate(Trade = case_when((dom %in% c(1,3,4)) & Basis < 0 ~ -1 , (dom %in% c(2)) & Basis > 0 ~ 1 ,TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
df <- BackAdj[["NG"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.001) %>%
mutate(Trade = case_when((dom %in% c(1,4)) & Basis < 0 ~ -1 , ,TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.001) %>%
mutate(Trade = case_when((dom %in% c(1,4)) & Basis < 0 ~ -1 ,TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
# OJ
df <- BackAdj[["OJ"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.002) %>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom == 1  & Basis > 0   ~ 1,TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
strategy_performance(filter(a) %>% pull(Excess), filter(a) %>% pull(date) %>% as.Date, period=52) %>% unlist
library(brms)
?bm
brm
?brm
a
filter(a) %>% pull(Excess) -> b
b
fit <- brm(Excess ~ 1, data=a)
fit
fit <- brm((Excess*100) ~ 1, data=a)
pp_check(fit)
fit
filter(a, Excess!=0) %>% pull(Excess) -> b
b
hist(b)
fit <- brm((Excess*100) ~ 1, data=a)
pp_check(fit)
fit
df <- data.frame(x=1:length(b), y=b)
df
fit <- brm((y*100) ~ 1, data=b)
fit <- brm((y*100) ~ 1, data=df)
pp_check(fit)
fit
as.data.frame(fit)
as.data.frame(fit) -> b
plot(density(b$b_Intercept/b$sigma*16))
plot(density(b$b_Intercept/b$sigma*sqrt(52)))
filter(a) %>% pull(Excess) -> b
df <- data.frame(x=1:length(b), y=b)
fit <- brm((y*100) ~ 1, data=df)
pp_check(fit)
as.data.frame(fit) -> b
plot(density(b$b_Intercept/b$sigma*sqrt(52)))
abline(v=0.87)
# soy meal
df <- BackAdj[["ZM"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.002) %>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom == 2  & Basis > 0  ~ 1   , TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
# Oats
df <- BackAdj[["ZO"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.002) %>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom == 2   ~ 1   , TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
# soy meal
df <- BackAdj[["ZM"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.002) %>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom == 2  & Basis > 0  ~ 1   , TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
filter(a) %>% pull(Excess) -> b
df <- data.frame(x=1:length(b), y=b)
fit <- brm((y*100) ~ 1, data=df)
as.data.frame(fit) -> b
plot(density(b$b_Intercept/b$sigma*sqrt(52)))
(b$b_Intercept/b$sigma*sqrt(52)) > 0
frequency((b$b_Intercept/b$sigma*sqrt(52)) > 0)
prop.table((b$b_Intercept/b$sigma*sqrt(52)) > 0)
table((b$b_Intercept/b$sigma*sqrt(52)) > 0)
# soy meal
df <- BackAdj[["ZM"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.002) %>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom == 2  & Basis > 0  ~ 1   , TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
filter(a, Excess!=0) %>% pull(Excess) -> b
df <- data.frame(x=1:length(b), y=b)
fit <- brm((y*100) ~ 1, data=df)
as.data.frame(fit) -> b
plot(density(b$b_Intercept/b$sigma*sqrt(52)))
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate(Trade = case_when( (dom %in% c(2)) & Basis > 0 ~ 1 ,TRUE ~ 0), Year=year(Date)) %>% group_by(Year, Trade) %>% summarise(Trade=first(Trade), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
df <- BackAdj[["ZM"]] %>% filter(year(Date) > 2000)
mutate(Trade = case_when( (dom %in% c(2)) & Basis > 0 ~ 1 ,TRUE ~ 0), Year=year(Date)) %>% group_by(Year, Trade) %>% summarise(Trade=first(Trade), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate(Trade = case_when( (dom %in% c(2)) & Basis > 0 ~ 1 ,TRUE ~ 0), Year=year(Date)) %>% group_by(Year, Trade) %>% summarise(Trade=first(Trade), Mean=mean(Return, na.rm=T), SD=0.1*sd(Return, na.rm=T)/sqrt(n()))
ggplot(a) + geom_bar(aes(Trade, Mean), stat="identity") + geom_errorbar(aes(x=Trade, ymin=Mean-SD, ymax=Mean+SD), width=0.5) + facet_wrap(~Year)+theme(text=element_text(size=8), strip.placement = "outside")
# Oats
df <- BackAdj[["ZO"]] %>% filter(year(Date) > 2000)
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.003) %>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom %in% c(1,2)  & Basis > 0 & Trend > 0 ~ 1   , TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.003) %>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom %in% c(1,2)   & Trend > 0 ~ 1   , TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.003) %>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom %in% c(1,2)  & Basis > 0  ~ 1   , TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
a <-
mutate(df, dom = mday(Date)) %>% mutate(dom = case_when(dom <= 7 ~ 1, dom > 7 & dom <= 14 ~ 2, dom > 14 & dom <= 21 ~ 3, dom > 21 & dom <= 31 ~ 4, TRUE ~ 0)) %>%
mutate(df, date=yearweek(Date), dow=wday(Date)) %>%
mutate( Cost = 0.003) %>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when(dom %in% c(1,2)  & Basis > 0 & Trend > 0 ~ 1   , dom %in% c(3,4)  & Basis < 0 & Trend < 0 ~ -1   , TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
ggplot(a) + geom_line(aes(date, PnL), linewidth=2)
with(a, mean(Excess)/sd(Excess)*sqrt(52))
# Coptemplate for week day
df <- BackAdj[["TG"]] %>% filter(year(Date) > 2000)
a <- mutate(df, dom=wday(Date), date=yearweek(Date)) %>%
mutate( Cost = 0)%>%
mutate(Trend = lag(EMA(AdjClose, 1) - EMA(AdjClose, 4))) %>%
mutate(Trade = case_when( dom == 6 & Trend < 0 ~ -1 , TRUE ~ 0)) %>%
mutate(Excess = Return * Trade) %>%
group_by(date) %>% summarise(Excess=sum(Excess, na.rm=TRUE), Trades=first(sum(unique(Trade)!=0)), Cost=first(Cost*Trades)) %>% ungroup %>%
summarise(date=date,PnL=cumsum(Excess-Cost),Excess=Excess-Cost, Cost=Cost)
strategy_performance(filter(a) %>% pull(Excess), filter(a) %>% pull(date) %>% as.Date, period=52) %>% unlist
strategy_performance
strategy_performance(filter(a) %>% pull(Excess), filter(a) %>% pull(date) %>% as.Date, period=52) %>% unlist
symbol
df <- BackAdj[[symbol]]
library(tidyverse)
df <-  mutate(df, Date = yearmonth(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
library(tsibble)
df <-  mutate(df, Date = yearmonth(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
df
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearmonth(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
head(df)
# Create ACF and PACF or year-to-year monthly log differences
setwd("/home/marco/trading/Systems/Monopoly/")
dir.create("Plots/Acf_yearly_backadj") # select nearest of backadj
setwd("Plots/Acf_yearly_backadj")
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearmonth(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
r <- c(0, diff(df$Return, 12))
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100)
dev.off()
}
?Acf
??Acf
library(forecast)
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearmonth(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
r <- c(0, diff(df$Return, 12))
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100)
dev.off()
}
df <-  mutate(df, Date = yearweek(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearweek(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
df
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearweek(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
r <- c(0, diff(df$Return, 1))
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100, cex=2)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100, cex=2)
dev.off()
}
dir.create("Plots/Acf_daily_backadj") # select nearest of backadj
i
# Create ACF and PACF or year-to-year monthly log differences
setwd("/home/marco/trading/Systems/Monopoly/")
dir.create("Plots/Acf_daily_backadj") # select nearest of backadj
setwd("Plots/Acf_daily_backadj")
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
#df <-  mutate(df, Date = yearweek(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
r <- c(0, diff(df$Return, 1))
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100, cex=2)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100, cex=2)
dev.off()
}
Acf(r, main=name, lag.max = 100, cex.title=2)
?Acf
# Create ACF and PACF or year-to-year monthly log differences
setwd("/home/marco/trading/Systems/Monopoly/")
dir.create("Plots/Acf_daily_backadj") # select nearest of backadj
setwd("Plots/Acf_daily_backadj")
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
#df <-  mutate(df, Date = yearweek(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
r <- df$Return
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100)
dev.off()
}
# Create ACF and PACF or year-to-year monthly log differences
setwd("/home/marco/trading/Systems/Monopoly/")
dir.create("Plots/Acf_weekly")
setwd("Plots/Acf_weekly")
df <-  mutate(df, Date = yearweek(Date)) %>% group_by(Date) %>%  summarise_all(last) %>% mutate(Date=as.Date(Date))
df
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearweek(Date)) %>% group_by(Date) %>%  summarise(Return=sum(Return))
df
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearweek(Date)) %>% group_by(Date) %>%  summarise(Return=sum(Return))
r <- df$Return
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100)
dev.off()
}
dir.create("Plots/Acf_monthly")
setwd("Plots/Acf_monthly")
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearmonth(Date)) %>% group_by(Date) %>%  summarise(Return=sum(Return))
r <- df$Return
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100)
dev.off()
}
# Create ACF and PACF or year-to-year monthly log differences
setwd("/home/marco/trading/Systems/Monopoly/")
dir.create("Plots/Acf_monthly")
setwd("Plots/Acf_monthly")
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearmonth(Date)) %>% group_by(Date) %>%  summarise(Return=sum(Return))
r <- df$Return
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100)
dev.off()
}
symbol
df
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearmonth(Date)) %>% group_by(Date) %>%  summarise(Return=sum(Return, na.rm=T))
r <- df$Return
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100)
dev.off()
}
# Create ACF and PACF or year-to-year monthly log differences
setwd("/home/marco/trading/Systems/Monopoly/")
dir.create("Plots/Acf_weekly")
setwd("Plots/Acf_weekly")
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearmonth(Date)) %>% group_by(Date) %>%  summarise(Return=sum(Return, na.rm=T))
r <- df$Return
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100)
dev.off()
}
dir.create("Plots/Acf_weekly")
setwd("Plots/Acf_weekly")
for(symbol in names(BackAdj)){
print(symbol)
df <- BackAdj[[symbol]]
df <-  mutate(df, Date = yearweek(Date)) %>% group_by(Date) %>%  summarise(Return=sum(Return, na.rm=T))
r <- df$Return
name <- to_load$Name[which(to_load$Symbol == symbol)]
png(paste0(name, "_Acf.png"))
Acf(r, main=name, lag.max = 100)
dev.off()
png(paste0(name, "_Pacf.png"))
Pacf(r, main=name, lag.max = 100)
dev.off()
}
