Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- (0.5*(1-exp(-1*y[i-1,1]))) / (y[i-1,1] + 1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- (0.25*(1-exp(-1*y[i-1,1]))) / (y[i-1,1] + 1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- (0.25*(1-exp(-1*y[i-1,1]))) / (y[i-1,1] + 1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- (0.25*(1-exp(1*y[i-1,1]))) / (y[i-1,1] + 1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- (0.25*(1-exp(-1*y[i-1,1]))) / (y[i-1,1] + 1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- (0.25*(1-exp(-1*y[i-1,1]))) / (y[i-1,1] + 1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- 0.15*logit_f(x[i-1,1], target, 5) / (x[i-1,1]+1e*6)
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- 0.15*logit_f(x[i-1,1], target, 5) / (x[i-1,1]+1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- 0.5*logit_f(x[i-1,1], target, 5) / (x[i-1,1]+1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- 0.5*logit_f(x[i-1,1], target, 2) / (x[i-1,1]+1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- 0.5*logit_f(x[i-1,1], target, 2) / (x[i-1,1]+1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- 0.25*logit_f(x[i-1,1], target, 2) / (x[i-1,1]+1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
# m2.0
# Inflation/Interest rate in a SSM-style
{
logit_f <- function(x, m, b) {
1 / (1 + exp(-b*(x-m)))
}
hl <- function(x) exp(-log(2)/x)
log0 <- function(x) ifelse(x > 0, log(x), 0)
layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
N <- 500
target <- 2
thresholds <- c(0, 0)
x <- matrix(NA, nrow=N, ncol=2)
y <- matrix(NA, nrow=N, ncol=2)
err_x <- rmvnorm(N, c(0,0), diag(c(0.2,0.01)))
err_y <- rmvnorm(N, c(0,0), diag(c(1,1)))*0.01
err_y[,2] <- 0
ss <- 3
x[1:ss,] <- c(0, 0)
y[1:ss,] <- x[1,]
for(i in ss:N) {
Z11 <- ifelse(x[i-1,1] > 0, hl(1000), hl(1))
Z22 <- ifelse(x[i-1,2] > 0, hl(5), hl(1))
Z12 <- -0.01
Z21 <- 0.5*logit_f(x[i-1,1], target, 2) / (x[i-1,1]+1e-6)
Z <- matrix(c(Z11, Z12,
Z21, Z22),
nrow = 2, byrow = TRUE)
#u <- (diag(c(1,1))-Z) %*% thresholds # MARSS chapter 14
H <- matrix(c(1, 1), ncol = 2, byrow = TRUE)
C <- matrix(c(0, 0,
0.05, 0), ncol = 2, byrow = TRUE)*0
x[i,] <- Z %*% x[i-1,] + u + C %*% (y[i-1,] - y[i-2,]) + err_x[i,]
#x[i,1] <- cpi[i]
y[i,] <- H * x[i,] + err_y[i,]
}
# x <- exp(x)
# y <- exp(y)
matplot2(x); grid()
matplot(y, type="p", pch=16, add=TRUE);
hist(y[,2], 20); plot(y);
}
m2.0 <- cmdstanr::cmdstan_model("Stan/m2.0.stan")
fit <- m2.0$variational(data=list(N=nrow(y), y=y, m0=as.numeric(y[1,]), P0=diag(c(1,1)), cpi_target=2, covariates=0, likelihood=1))
fit
fit <- m2.0$sample(data=list(N=nrow(y), y=y, m0=as.numeric(y[1,]), P0=diag(c(1,1)), cpi_target=0, covariates=0, likelihood=1), chains=4, cores = 4,iter_warmup = 250, iter_sampling = 250, init=1)
fit <- m2.0$sample(data=list(N=nrow(y), y=y, m0=as.numeric(y[1,]), P0=diag(c(1,1)), cpi_target=2, covariates=0, likelihood=1), chains=4, cores = 4,iter_warmup = 250, iter_sampling = 250, init=1)
